<%# Recipe Card for Grid View - Uniform height with overlay design %>

<%= link_to recipe, class: "block group relative h-[224px] rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-all cursor-pointer #{recipe.cover_image.attached? ? 'bg-gray-200 dark:bg-gray-700' : 'bg-surface-raised dark:bg-gray-800 border border-border-subtle dark:border-gray-700'}", data: { testid: "recipe-card-#{recipe.id}" } do %>

  <% if recipe.cover_image.attached? %>
    <%# Full-bleed background image %>
    <%= image_tag recipe.cover_image.variant(:thumbnail),
        alt: recipe.name,
        class: "absolute inset-0 w-full h-full object-cover",
        loading: "lazy" %>

    <%# Gradient overlay for text readability %>
    <div class="absolute inset-0 bg-[linear-gradient(to_top,rgba(0,0,0,0.6)_0%,rgba(0,0,0,0.35)_40%,transparent_70%)]"></div>
  <% end %>

  <%# Favorite button - positioned in top-right %>
  <%= render "recipes/favorite_button", recipe: recipe, context: :card %>

  <%# Content - Positioned at Bottom %>
  <div class="absolute inset-x-0 bottom-0 p-4 flex flex-col">
    <%# Title %>
    <h3 class="font-serif font-bold text-lg leading-tight mb-2 line-clamp-2 <%= recipe.cover_image.attached? ? 'text-gray-100' : 'text-text-primary dark:text-gray-100' %>">
      <%= recipe.name %>
    </h3>

    <%# Time + Tag Row %>
    <div class="flex items-center justify-between">
      <%# Time (left side) %>
      <% total_time = (recipe.prep_time || 0) + (recipe.cook_time || 0) %>
      <% if total_time > 0 %>
        <div class="flex items-center gap-1 text-xs <%= recipe.cover_image.attached? ? 'text-gray-300' : 'text-text-tertiary dark:text-gray-500' %>">
          <%= lucide_icon "clock", class: "size-3" %>
          <span><%= total_time %>m</span>
        </div>
      <% else %>
        <div></div>
      <% end %>

      <%# Tag (right side) %>
      <% if recipe.tags.any? %>
        <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-sm <%= recipe.cover_image.attached? ? 'text-amber-400 bg-black/40' : 'text-brand-primary dark:text-amber-500 bg-brand-primary/10 dark:bg-amber-500/10' %>">
          <%= recipe.tags.first.name %>
        </span>
      <% end %>
    </div>
  </div>
<% end %>
